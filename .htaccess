## Security and clean URLs
<IfModule mod_headers.c>
  Header set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header set X-XSS-Protection "1; mode=block"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Always allow static assets to pass through (no rewrites)
  RewriteRule ^public/(.*)$ - [L]
  RewriteRule ^(images|img|css|js)/(.*)$ - [L]
  RewriteRule ^(.+)\.(jpg|jpeg|png|gif|webp|svg|ico)$ - [L]

  # Map root to index.php
  RewriteRule ^$ index.php [L]

  # Redirect *.php requests to extensionless URL (only when explicitly requested)
  RewriteCond %{THE_REQUEST} \s/([^\s?]+)\.php[\s?]
  RewriteRule ^ /%1 [R=301,L]

  # Serve existing files/directories
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # Map extensionless paths to PHP files
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^([^\.]+)$ $1.php [NC,L,QSA]
</IfModule>

## Disable directory listing
Options -Indexes

## Deny access to sensitive files
<FilesMatch "\.(env|ini|log|sql|sh|bat)$">
  Require all denied
</FilesMatch>

<Files ".git*">
  Require all denied
</Files>

## Protect .htaccess itself
<Files ".htaccess">
  Require all denied
</Files>